/*! signet 16-05-2017 */

function signetBuilder(a,b,c,d,e){"use strict";function f(b,c){var e=d.parseType(c),f=a.isTypeOf(e);a.defineSubtypeOf(e.type)(b,function(a){return f(a)})}function g(b){return"string"==typeof b?a.isTypeOf(d.parseType(b)):b}function h(a,b,c){return Object.defineProperty(a,b,{value:c,writeable:!1}),a}function i(a,b){return h(a,"signatureTree",b),Object.defineProperty(a,"signature",{writeable:!1,get:function(){return e.assembleSignature(a.signatureTree)}}),a}function j(a,b){var d=c.checkSignature(a),f=a.length-1;if(a.length<2)throw new SyntaxError("Signature must have both input and output types");if(a[0].length<b.length)throw new Error("Signature declaration too short for function with "+b.length+" arguments.");if(a[f].length>1)throw new SyntaxError("Signature can only have a single output type");if(null!==d){var g=d.map(e.assembleType);throw new TypeError("Signature contains invalid types: "+g.join(", "))}}function k(a,b){return i(b,a),h(b,"signatureTree",a)}function l(a,b){var c=d.parseSignature(a);return j(c,b),k(c,b)}function m(a){return a[a.length-1]}function n(a,b){var c=typeof a[1],d="Expected a "+b+"value of type "+a[0]+" but got "+a[1]+" of type "+c;throw new TypeError(d)}function o(a,c){var d=b.validateArguments(a.signatureTree[0])(c);null!==d&&n(d,"")}function p(a,b,c,d){if("function"==typeof b)throw new Error(b(a,c,d));n(a,"")}function q(a,b,c,d){if("function"==typeof b)throw new Error(b(a,c,d));n(a,"return ")}function r(a,c,d){return function(){var f=Array.prototype.slice.call(arguments,0),g=b.validateArguments(a[0])(f);null!==g&&p(g,d.inputErrorBuilder,f,a);var h=a.length>2,i=h?ra:m(a)[0],j=e.assembleType(i),k=c.apply(null,f);return b.validateType(i)(k)||q([j,k],d.outputErrorBuilder,f,a),h?u(a.slice(1),k,d):k}}function s(a){for(var b="a".charCodeAt(0),c=[],d=0;d<a;d++)c.push(String.fromCharCode(b+d));return c.join(", ")}function t(a){return function(b){return a.apply(null,Array.prototype.slice.call(arguments,0))}}function u(a,b,c){var d=r(a,b,c),e=(s(b.length),t(d));return e.toString=Function.prototype.toString.bind(b),k(a,e)}function v(b){return b.typeCheck=a.isTypeOf(b),b}function w(a){var b=a.map(v);return b.dependent=a.dependent,b}function x(a){return a.map(w)}function y(a,b,c){return u(x(d.parseSignature(a)),b,"object"==typeof c&&null!==c?c:{})}function z(b,c){a.defineSubtypeOf("object")(b,C(c))}function A(a,b){return"string"==typeof a[b]?a[b]:a[b].name}function B(a,b){return function(c){return a.reduce(function(a,d){var e=d[0];return(0,d[1])(c[e])||a.push([e,A(b,e),c[e]]),a},[])}}function C(a){function b(a){return 0===d(a).length}var c=Object.keys(a).map(function(b){return[b,g(a[b])]}),d=B(c,a);return b.getErrors=d,b}function D(a){return function(b,c){return!a(b,c)}}function E(a,b){function c(c){return a[c]!==b[c]}if(T(a)||T(b)||a===b)return a===b;var d=Object.keys(a);return!(d.length!==Object.keys(b).length)&&0===d.filter(c).length}function F(a,b){return 0===Object.keys(b).filter(function(c){return typeof a[c]==typeof b[c]}).length}function G(a,b){return!(Object.keys(a).length<Object.keys(b).length)&&F(a,b)}function H(a,b){return G(b,a)}function I(a,b){return Object.keys(a).length===Object.keys(b).length&&F(a,b)}function J(a,b,c,d){return K(a,c)===K(b,d)}function K(a,b){return M(b.subtype)(a)}function L(a){return M(d.parseType(a).subtype)}function M(a){return function(b){var c=a.filter(function(a){return g(a)(b)})[0];return"string"!=typeof c?null:c}}function N(b,c,d,e){var f=K(b,d),g=K(c,e);return a.isSubtypeOf(g)(f)}function O(a,b,c,d){return N(b,a,d,c)}function P(a,b){return a>b}function Q(a,b){return a<b}function R(a,b){return a===b}function S(a){return function(b){return typeof b===a}}function T(a){return null===a}function U(a,b){if(0===b.length||"*"===b[0])return!0;var c=g(b[0]);return a.filter(c).length===a.length}function V(a,b){return"[object Array]"===Object.prototype.toString.call(a)&&U(a,b)}function W(a){return Math.floor(a)===a&&a!==1/0}function X(){function a(a,b){return b.min<=a&&a<=b.max}return a.preprocess=Y,a}function Y(a){return{min:Number(a[0]),max:Number(a[1])}}function Z(){function a(a,b){return a>=b}return a.preprocess=_,a}function $(){function a(a,b){return a<=b}return a.preprocess=_,a}function _(a){return Number(a[0])}function aa(a,b){return sa(a.length,b)}function ba(a){return RegExp(a.join(";"))}function ca(a,b){return null!==a.match(b)}function da(a){return a.map(g)}function ea(a){return a.subtype=a.subtype.map(g),a}function fa(a){return!T(a)}function ga(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function ha(b,c){var d=b===c?1:0;return a.isSubtypeOf(b)(c)?-1:d}function ia(a,b){var c=0,d=0;for(c;c<a.length&&0===(d=ha(a[c],b));c++);return a.splice(c+d,0,b),a}function ja(a){return a.reduce(ia,[])}function ka(a){var b=a.slice(0);return function(a){for(var c=!1,d=g(a),e=0;e<b.length;e++)if(d(b[e])){c=!0,b.splice(e,1);break}return!c}}function la(a,b){return 0===b.filter(ka(a)).length}function ma(a,b){return a.length===b.length&&la(a,ja(b))}function na(a,b){function c(b,c,d){return b&&c(a[d])}return a.length===b.length&&b.reduce(c,!0)}function oa(a,b){function c(b){return b(a)}return 0===b.length||b.filter(c).length>0}function pa(a,b){return console.warn("Tagged Union is deprecated, use variant instead."),oa(a,b)}function qa(b){var c=ua(b);if(c&&"string"==typeof b){var e=d.parseType(b);c=a.isType(e.type)}return c}var ra=d.parseType("function"),sa=X();aa.preprocess=Y,ca.preprocess=ba,d.registerTypeLevelMacro("tuple",ea),oa.preprocess=da,pa.preprocess=da;var ta=d.parseType("*");d.registerTypeLevelMacro("()",function(){return ta}),a.define("boolean",S("boolean")),a.define("function",S("function")),a.define("number",S("number")),a.define("object",S("object")),a.define("string",S("string")),a.define("symbol",S("symbol")),a.define("undefined",S("undefined")),a.define("null",T),a.define("variant",oa),a.define("taggedUnion",pa);var ua=g("variant<string; function>");return a.define("type",qa),a.defineSubtypeOf("object")("array",V),a.defineSubtypeOf("object")("regexp",ga),a.defineSubtypeOf("number")("int",W),a.defineSubtypeOf("number")("bounded",X()),a.defineSubtypeOf("number")("leftBounded",Z()),a.defineSubtypeOf("number")("rightBounded",$()),a.defineSubtypeOf("int")("boundedInt",X()),a.defineSubtypeOf("int")("leftBoundedInt",Z()),a.defineSubtypeOf("int")("rightBoundedInt",$()),a.defineSubtypeOf("string")("boundedString",aa),a.defineSubtypeOf("string")("formattedString",ca),a.defineSubtypeOf("array")("tuple",na),a.defineSubtypeOf("array")("unorderedProduct",ma),a.defineSubtypeOf("object")("arguments",fa),f("any","*"),f("void","*"),a.defineDependentOperatorOn("number")(">",P),a.defineDependentOperatorOn("number")("<",Q),a.defineDependentOperatorOn("number")("=",R),a.defineDependentOperatorOn("number")(">=",D(Q)),a.defineDependentOperatorOn("number")("<=",D(P)),a.defineDependentOperatorOn("number")("!=",D(R)),a.defineDependentOperatorOn("string")("=",R),a.defineDependentOperatorOn("string")("!=",D(R)),a.defineDependentOperatorOn("object")("=",E),a.defineDependentOperatorOn("object")("!=",D(E)),a.defineDependentOperatorOn("object")(":>",G),a.defineDependentOperatorOn("object")(":<",H),a.defineDependentOperatorOn("object")(":=",I),a.defineDependentOperatorOn("object")(":!=",D(I)),a.defineDependentOperatorOn("variant")("isTypeOf",J),a.defineDependentOperatorOn("variant")("=:",J),a.defineDependentOperatorOn("variant")("<:",N),a.defineDependentOperatorOn("variant")(">:",O),{alias:y("aliasName != typeString :: aliasName:string, typeString:string => undefined",f),duckTypeFactory:y("duckTypeDef:object => function",C),defineDuckType:y("typeName:string, duckTypeDef:object => undefined",z),defineDependentOperatorOn:y("typeName:string => operator:string, operatorCheck:function => undefined",a.defineDependentOperatorOn),enforce:y("signature:string, functionToEnforce:function, options:[object] => function",y),extend:y("typeName:string, typeCheck:function => undefined",a.define),isSubtypeOf:y("rootTypeName:string => typeNameUnderTest:string => boolean",a.isSubtypeOf),isType:y("typeName:string => boolean",a.isType),isTypeOf:y("typeToCheck:type => value:* => boolean",g),registerTypeLevelMacro:y("typeKey:string, macro:function => undefined",d.registerTypeLevelMacro),sign:y("signature:string, functionToSign:function => function",l),subtype:y("rootTypeName:string => subtypeName:string, subtypeCheck:function => undefined",a.defineSubtypeOf),typeChain:y("typeName:string => string",a.getTypeChain),verify:y("signedFunctionToVerify:function, functionArguments:arguments => undefined",o),whichType:y("typeNames:array<string> => value:* => variant<string; null>",M),whichVariantType:y("variantString:string => value:* => variant<string; null>",L)}}var signetAssembler=function(){"use strict";function a(a){return a.subtype&&a.subtype.length>0}function b(b){return a(b)?"<"+b.subtype.join(";")+">":""}function c(a){var c=a.type+b(a);return a.optional?"["+c+"]":c}function d(a){return a.map(c).join(", ")}function e(a){return a.map(d).join(" => ")}return{assembleSignature:e,assembleType:c}}();"udefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetAssembler);var signetChecker=function(){"use strict";return function(a){function b(b){return"function"==typeof a.get(b.type)}function c(a,b){return a.concat(b)}function d(a){return function(b){return!a(b)}}function e(a){var e=a.reduce(c,[]).filter(d(b));return e.length>0?e:null}return{checkSignature:e,checkType:b}}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetChecker);var signetParser=function(){"use strict";function a(a){return a}function b(b){var c=p[b.type];return(c=void 0===c?a:c)(b)}function c(a,b){p[a]=b}function d(a,b){return 1===a.length&&";"===b||">"===b&&0===a.length}function e(a){return null!==a.match(/[\<\;\s]/)}function f(a,b){return a.length>1||0===a.length&&">"===b||a.length>0&&!e(b)}function g(a,b){"<"===b?a.push(b):">"===b&&a.pop()}function h(a){return function(b,c){return f(a,c)?b+c:b}}function i(a,b){return function(c,e){d(a,e)&&b.push(c)}}function j(a,b){return function(c,e){return d(a,e)?"":b(c,e)}}function k(a){var b="",c=[],d=[],e=j(d,h(d)),f=i(d,c);return a.split("").forEach(function(a){g(d,a),f(b,a),b=e(b,a)}),c}function l(a){var c=a.replace(/^([^:<]+)\:(.+)$/,"$1"),d=a.replace(/^([^:<]+)\:(.+)$/,"$2");return b({name:c===a?null:c.trim(),type:d.split("<")[0].replace(/\[|\]/g,"").trim(),subtype:k(d),optional:null!==d.match(/^\[[^\]]+\]$/)})}function m(a){var b=a.trim().split(/\s+/g);return{operator:b[1],left:b[0],right:b[2]}}function n(a){var b=a.split(/\s*\:\:\s*/),c=b.length>1?b.shift():null,d=b[0].split(/\s*\,\s*/).map(l);return d.dependent=null===c?null:m(c),d}function o(a){return a.split(/\s*\=\>\s*/).map(n)}var p={};return{parseSignature:o,parseType:l,registerTypeLevelMacro:c}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetParser);var signetRegistrar=function(){"use strict";return function(){function a(a,b){return typeof b===a}function b(b){return a("string",b)&&null!==b.match(/^[^\(\)\<\>\[\]\:\;\=\,\s]+$/)}function c(c,d){if(!b(c))throw new Error("Invalid type name: "+c);if(!a("undefined",f[c]))throw new Error("Type already registered with name "+c);if(!a("function",d))throw new Error("Type predicate parameter must be a function")}function d(a){return f[a]}function e(a,b){c(a,b),f[a]=b}var f={};return{get:d,set:e}}}();"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetRegistrar);var signetTypelog=function(a,b){"use strict";function c(a){return function(b){return a.optional&&void 0===b}}function d(b){var d=c(b);return function(c){return a.get(b.type)(c,b.subtype)||d(c)}}function e(a,b,c){Object.defineProperty(a,b,{value:c,writeable:!1})}function f(b){return function(c,d){e(d,"parentTypeName",b),a.set(c,d)}}function g(b){try{return"function"==typeof a.get(b)}catch(a){return!1}}function h(b){return function(c){var d=a.get(c).parentTypeName,e=void 0===d,f=d===b;return e||f?f:h(b)(d)}}function i(b){var c=k(b);return function(d){var e=a.get(b.type),f=e.parentTypeName;return!(void 0!==f)||l(c,f,d)}}function j(a){return a}function k(b){var c=a.get(b.type),d="function"==typeof c.preprocess?c.preprocess:j;return{name:b.name,type:b.type,subtype:d(b.subtype),originalSubtype:b.subtype,optional:b.optional}}function l(a,c,e){var f=b.parseType(c);return f.subtype.concat(a.originalSubtype),i(f)(e)&&d(a)(e)}function m(b){var c=a.get(b);return void 0!==c.parentTypeName?m(c.parentTypeName)+" -> "+b:b}function n(b){var c=a.get(b);return function(a,b){e(c,a,{operator:a,operation:b})}}function o(b){return function(c){var d=a.get(b);return"object"==typeof d[c]?d[c]:"*"==b?null:o(d.parentTypeName)(c)}}return a.set("*",function(){return!0}),{define:f("*"),defineDependentOperatorOn:n,defineSubtypeOf:f,getDependentOperatorOn:o,getTypeChain:m,isType:g,isTypeOf:i,isSubtypeOf:h}};"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetTypelog);var signetValidator=function(){"use strict";function a(a){return a[0]}function b(a){return a.slice(1)}return function(c,d,e){function f(a){return"object"==typeof a&&null!==a}function g(a,b,c){return a.optional&&(c.length>1||void 0===b)}function h(a){return"function"==typeof a.typeCheck?a.typeCheck:c.isTypeOf(a)}function i(c,e){var f=a(c),i=a(e),j=h(f)(i),k=j?b(e):e,l=r(b(c));return j||g(f,i,c)?l(k):[d.assembleType(f),i]}function j(a,b,c){var d=null;if(!c.operation(a.value,b.value,a.typeNode,b.typeNode)){d=[[a.name,c.operator,b.name].join(" "),[a.name,"=",a.value,"and",b.name,"=",b.value].join(" ")]}return d}function k(){return!1}function l(a,b){var d=c.getDependentOperatorOn(a)(b);return null===d&&(d={operator:b,operation:k}),d}function m(a){function b(a){return f(a)}var d=e.parseType(a),f=c.isTypeOf(d);return b.toString=function(){return"[function typePredicate]"},{name:a,value:b,typeNode:d}}function n(a){return{name:a,value:a,typeNode:{}}}function o(a,b){var d=a[b];return void 0===d&&(d=c.isType(b)?m(b):n(b)),d}function p(a,b,c){var d=null;if(null===c&&f(a)){var e=b[a.left];d=j(e,o(b,a.right),l(e.typeNode.type,a.operator))}return null===d?c:d}function q(a,b){for(var c,d,e={},f=a.length,g=0;g<f;g++)c=a[g],d=c.name,e[d]={name:d,value:b[g],typeNode:a[g]};return e}function r(a){var b=a.dependent;return function(c){var d=q(a,c),e=0===a.length?null:i(a,c);return p(b,d,e)}}return{validateArguments:r,validateType:h}}}();"undefined"!=typeof module&&void 0!==typeof module.exports&&(module.exports=signetValidator),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=signetBuilder);var signet=function(){"use strict";function a(){var a=signetAssembler,b=signetParser,c=signetRegistrar(),d=signetChecker(c),e=signetTypelog(c,b);return signetBuilder(e,signetValidator(e,a),d,b,a)}return"undefined"!=typeof module&&void 0!==module.exports&&(module.exports=a),a()}();
//# sourceMappingURL=signet.min.js.map