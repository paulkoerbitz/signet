/*! signet 29-12-2016 */

function signetBuilder(a,b,c,d,e){"use strict";function f(a){return function(b){return typeof b===a}}function g(b,c){var e=d.parseType(c);a.defineSubtypeOf(e.type)(b,a.isTypeOf(e))}function h(b){return"string"==typeof b?a.isTypeOf(d.parseType(b)):b}function i(a,b,c){return Object.defineProperty(a,b,{value:c,writeable:!1}),a}function j(a,b){return i(a,"signatureTree",b),Object.defineProperty(a,"signature",{writeable:!1,get:function(){return e.assembleSignature(a.signatureTree)}}),a}function k(a,b){var d=c.checkSignature(a),f=a.length-1;if(a.length<2)throw new SyntaxError("Signature must have both input and output types");if(a[0].length<b.length)throw new Error("Signature declaration too short for function with "+b.length+" arguments.");if(a[f].length>1)throw new SyntaxError("Signature can only have a single output type");if(null!==d){var g=d.map(e.assembleType);throw new TypeError("Signature contains invalid types: "+g.join(", "))}}function l(a,b){return j(b,a),i(b,"signatureTree",a)}function m(a,b){var c=d.parseSignature(a);return k(c,b),l(c,b)}function n(a){return a[a.length-1]}function o(a,b){var c=typeof a[1],d="Expected a "+b+"value of type "+a[0]+" but got "+a[1]+" of type "+c;throw new TypeError(d)}function p(a,c){var d=b.validateArguments(a.signatureTree[0])(c);null!==d&&o(d,"")}function q(a,c){return function(){var d=Array.prototype.slice.call(arguments,0),f=b.validateArguments(a[0])(d);null!==f&&o(f,"");var g=a.length>2,h=g?z:n(a)[0],i=e.assembleType(h),j=c.apply(null,d);return b.validateType(h)(j)||o([i,j],"return "),g?s(a.slice(1),j):j}}function r(a){for(var b="a".charCodeAt(0),c=[],d=0;d<a;d++)c.push(String.fromCharCode(b+d));return c.join(", ")}function s(a,b){var c=q(a,b),d=r(b.length),e=Function("enforcer",A.replace("{args}",d))(c);return e.toString=b.toString.bind(b),e}function t(a,b){var c=d.parseSignature(a);return s(c,b)}function u(){return function(a,b){var c=Number(b[0]),d=Number(b[1]);return c<=a&&a<=d}}function v(a,b){return 0===a.length||a.filter(b).length>0}function w(a,b){return v(b,function(b){return h(b)(a)})}function x(b,c){a.defineSubtypeOf("object")(b,y(c))}function y(a){var b=Object.keys(a).reduce(function(b,c){var d=h(a[c]);return b.push([c,d]),b},[]);return function(a){return b.reduce(function(b,c){var d=c[0],e=c[1];return b&&e(a[d])},!0)}}var z=d.parseType("function"),A=["return function ({args}){","return enforcer.apply(null, Array.prototype.slice.call(arguments))","}"].join("");a.define("boolean",f("boolean")),a.define("function",f("function")),a.define("number",f("number")),a.define("object",f("object")),a.define("string",f("string")),a.define("symbol",f("symbol")),a.define("undefined",f("undefined")),a.define("null",function(a){return null===a}),g("any","*"),g("void","*"),a.defineSubtypeOf("object")("array",function(a){return"[object Array]"===Object.prototype.toString.call(a)}),a.defineSubtypeOf("number")("int",function(a){return Math.floor(a)===a}),a.defineSubtypeOf("number")("bounded",u()),a.defineSubtypeOf("int")("boundedInt",u());var B=u();return a.defineSubtypeOf("string")("boundedString",function(a,b){return B(a.length,b)}),a.defineSubtypeOf("string")("formattedString",function(a,b){var c=RegExp(b.join(";"));return null!==a.match(c)}),a.defineSubtypeOf("array")("tuple",function(a,b){var c=a.length===b.length,d=!1;if(c)var d=b.reduce(function(b,c,d){return b&&h(c)(a[d])},!0);return d}),a.define("variant",w),a.define("taggedUnion",function(a,b){return console.warn("Tagged Union is deprecated, use variant instead."),w(a,b)}),g("type","variant<string; function>"),g("arguments","variant<array; object>"),{alias:t("string, string => undefined",g),duckTypeFactory:t("object => function",y),defineDuckType:t("string, object => undefined",x),enforce:t("string, function => function",t),extend:t("string, function => undefined",a.define),isSubtypeOf:t("string => string => boolean",a.isSubtypeOf),isType:t("string => boolean",a.isType),isTypeOf:t("type => * => boolean",h),sign:t("string, function => function",m),subtype:t("string => string, function => undefined",a.defineSubtypeOf),typeChain:t("string => string",a.getTypeChain),verify:t("function, arguments => undefined",p)}}var signetAssembler=function(){"use strict";function a(a){return a.subtype&&a.subtype.length>0}function b(b){return a(b)?"<"+b.subtype.join(";")+">":""}function c(a){var c=a.type+b(a);return a.optional?"["+c+"]":c}function d(a){return a.map(c).join(", ")}function e(a){return a.map(d).join(" => ")}return{assembleSignature:e,assembleType:c}}();"udefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=signetAssembler);var signetChecker=function(){"use strict";return function(a){function b(b){return"function"==typeof a.get(b.type)}function c(a,b){return a.concat(b)}function d(a){return function(b){return!a(b)}}function e(a){var e=a.reduce(c,[]).filter(d(b));return e.length>0?e:null}return{checkSignature:e,checkType:b}}}();"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=signetChecker);var signetParser=function(){"use strict";function a(a,b){return 1===a.length&&";"===b||">"===b&&0===a.length}function b(a){return null!==a.match(/[\<\;\s]/)}function c(a,c){return a.length>1||0===a.length&&">"===c||a.length>0&&!b(c)}function d(a,b){"<"===b?a.push(b):">"===b&&a.pop()}function e(a){return function(b,d){var e=c(a,d);return e?b+d:b}}function f(b,c){return function(d,e){a(b,e)&&c.push(d)}}function g(b,c){return function(d,e){var f=a(b,e);return f?"":c(d,e)}}function h(a){var b="",c=[],h=[],i=g(h,e(h)),j=f(h,c);return a.split("").forEach(function(a){d(h,a),j(b,a),b=i(b,a)}),c}function i(a){var b=/^([^\:]+)\:(.+)$/,c=a.replace(b,"$1"),d=a.replace(b,"$2");return{name:c===a?null:c.trim(),type:d.split("<")[0].replace(/\[|\]/g,"").trim(),subtype:h(d),optional:null!==d.match(/^\[[^\]]+\]$/)}}function j(a){return a.split(/\s*\,\s*/).map(i)}function k(a){var b=a.split(/\s*\=\>\s*/);return b.map(j)}return{parseSignature:k,parseType:i}}();"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=signetParser);var signetRegistrar=function(){"use strict";return function(){function a(a,b){return typeof b===a}function b(b){return a("string",b)&&null!==b.match(/^[^\(\)\<\>\[\]\:\;\=\,\s]+$/)}function c(c,d){if(!b(c))throw new Error("Invalid type name: "+c);if(!a("undefined",f[c]))throw new Error("Type already registered with name "+c);if(!a("function",d))throw new Error("Type predicate parameter must be a function")}function d(a){return f[a]}function e(a,b){c(a,b),f[a]=b}var f={};return{get:d,set:e}}}();"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=signetRegistrar);var signetTypelog=function(a,b){function c(a){return function(b){return a.optional&&"undefined"==typeof b}}function d(b){var d=c(b);return function(c){return a.get(b.type)(c,b.subtype)||d(c)}}function e(a,b,c){Object.defineProperty(a,b,{value:c,writeable:!1})}function f(b){return function(c,d){e(d,"parentTypeName",b),a.set(c,d)}}function g(b){return"function"==typeof a.get(b)}function h(b){return function(c){var d=a.get(c);return"undefined"!=typeof d.parentTypeName&&(d.parentTypeName===b||h(b)(d.parentTypeName))}}function i(c){return function(e){var f=a.get(c.type),g=!1;if("undefined"==typeof f.parentTypeName)g=!0;else{var h=b.parseType(f.parentTypeName);h.subtype.concat(c.subtype),g=i(h)(e)&&d(c)(e)}return g}}function j(b){var c=a.get(b);return void 0!==c.parentTypeName?j(c.parentTypeName)+" -> "+b:b}return a.set("*",function(){return!0}),{define:f("*"),defineSubtypeOf:f,getTypeChain:j,isType:g,isTypeOf:i,isSubtypeOf:h}};"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=signetTypelog);var signetValidator=function(){"use strict";function a(a){return a[0]}function b(a){return a.slice(1)}return function(c,d){function e(a,b,c){return a.optional&&(c.length>1||"undefined"==typeof b)}function f(a){return c.isTypeOf(a)}function g(c,g){var i=a(c),j=a(g),k=f(i)(j),l=k?b(g):g,m=h(b(c)),n=k||e(i,j,c);return n?m(l):[d.assembleType(i),j]}function h(a){return function(b){return 0===a.length?null:g(a,b)}}return{validateArguments:h,validateType:f}}}();"undefined"!=typeof module&&void 0!==typeof module.exports&&(module.exports=signetValidator),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=signetBuilder);var signet=function(){"use strict";function a(){var a=signetAssembler,b=signetParser,c=signetRegistrar(),d=signetChecker(c),e=signetTypelog(c,b),f=signetValidator(e,a);return signetBuilder(e,f,d,b,a)}return"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=a),a()}();
//# sourceMappingURL=signet.min.js.map